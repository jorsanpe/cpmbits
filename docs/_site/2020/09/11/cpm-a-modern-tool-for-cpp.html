<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CPM Bits</title>
    <link rel="stylesheet" href="/assets/css/cpmbits.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="/assets/css/prism.css" rel="stylesheet">
    <link href="/assets/css/bulma-divider.min.css" rel="stylesheet">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script src="/assets/js/prism.js"></script>
    <title>CPM: A Modern Tool for C/C++</title>
  </head>
  <body>
    <nav class="navbar has-shadow is-light" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://cpmbits.com">
                <img src="/assets/images/cpmbits-logo.png" height="28">
            </a>

            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false"
                data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div id="navbar-links" class="navbar-menu">
            <div class="navbar-start">
                
                
                <a href="/documentation/getting_started.html" class="navbar-item ">
                    Documentation
                </a>
                
                <a href="/blog_cover.html" class="navbar-item ">
                    Blog
                </a>
                
                <div class="navbar-item">
                    <a class="button is-light" href="https://github.com/jorsanpe/cpm" target="_blank">
                        <img src="/assets/images/GitHub-Mark-32px.png" height="28">
                    </a>
                </div>
            </div>

            <div class="navbar-end">
                <div class="navbar-item">
                    <div class="field has-addons">
                        <div class="control has-icons-left">
                            <input class="input" id="search_query" type="text" placeholder="Search bits">
                            <span class="icon is-small is-left">
                                <i class="fa fa-search"></i>
                            </span>
                        </div>
                        <div class="control">
                            <a class="button is-primary" id="search_query_submit">
                                Search
                            </a>
                        </div>
                    </div>
                </div>
                <div class="navbar-item">
                    <div class="buttons">
                        <a class="button" title="User registration only with inviation" href="/registration_page.html">
                            <strong>Sign up</strong>
                        </a>
                        <a class="button is-light">
                            Log in
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>
      <section class="section">
    <div class="container">
      <div class="columns">
        <div class="column content">
          <h1 class="title is-2">CPM: A Modern Tool for C/C++</h1>
          <p><em>11 Sep 2020, Jordi Sánchez</em></p>
          <p>Unlike other more modern languages, C/C++ does not have a unified centralized tool for package and project management. Take for example <code class="language-plaintext highlighter-rouge">pip</code>; this tool offers an ecosystem from which developers can greatly benefit. It speeds up development, as dependencies are just one command away, without the need for complex installation recipes or hunting for repositories. Python is not the only one to offer a “dependency hub”; others like Java, Ruby or JavaScript also have their own ecosystems.</p>

<p>The main goal of CPM is to offer an ecosystem for C/C++ developers. It is composed of two main ingredients: the command line tool and the bits repository.</p>

<h2 id="a-tutorial">A Tutorial</h2>

<p>CPM is written in Python 3.7. It can be installed using <code class="language-plaintext highlighter-rouge">pip</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install cpm-cli
</code></pre></div></div>

<p>The command line tool is not a build system, it’s an orchestrator, so two additional tools are required in order to compile the project sources. First, CPM generates compilation recipes for <a href="https://cmake.org" target="_blank" rel="noopener">CMake</a>. Second, it uses the CMake <a href="https://ninja-build.org" target="_blank" rel="noopener">Ninja</a> generator. Needless to say that a C/C++ compiler is also required. CPM does not rely on any particular version of the aforementioned tools, so if you install the latest version of each you should be good to go.</p>

<h2 id="creating-a-new-project">Creating a new Project</h2>

<p>Creating a new project is straightforward:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cpm create awesome-project
</code></pre></div></div>

<p>The newly created project includes a hello world template that can be built right away:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd awesome-project
cpm build
</code></pre></div></div>

<p>New projects are created with sample “Hello World” code. The build files are placed in the <code class="language-plaintext highlighter-rouge">build</code> folder so in order to run the compiled project:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build/awesome-project
Hello World!
</code></pre></div></div>

<p>Let’s take a look at the project contents. Right now, they are:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>project.yaml
main.cpp
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">project.yaml</code> file is the project descriptor and it contains the project configuration as defined by the user. The <code class="language-plaintext highlighter-rouge">main.cpp</code> file is the program entry point and at the time of writing this tutorial it is required to be at the project root (the reasons for this are beyond the scope of this tutorial).</p>

<h3 id="packages">Packages</h3>

<p>Projects in CPM are structured around <strong>packages</strong>. A package is a collection of (hopefully) related code that can be addressed from the package root. They try to be analogous to Python or Java packages. Let’s see how they work with an example of a package named <code class="language-plaintext highlighter-rouge">authentication</code>.</p>

<p>First, we have to create the package root directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir authentication
</code></pre></div></div>

<p>Second, we have to declare the package in the project descriptor:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name: awesome-project
packages:
    authentication:
</code></pre></div></div>

<p>Finally, let’s create an <code class="language-plaintext highlighter-rouge">Authenticator</code> class belonging to that package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>authentication/Authenticator.cpp
authentication/Authenticator.h
</code></pre></div></div>

<p>By design, both source and header files are placed in the same directory. Now, imagine that we want to make use of the <code class="language-plaintext highlighter-rouge">Authenticator</code> class. In order to do so, we need to include the class header from elsewhere:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;authentication/Authenticator.h&gt;
</code></pre></div></div>

<p>CPM will automatically solve the include directories required to make this work. Packages can be declared at any level. For example, if the package root directory is not contained directly under the root directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>domain/authentication/Authenticator.cpp
domain/authentication/Authenticator.h
</code></pre></div></div>

<p>The project descriptor would be:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name: awesome-project
packages:
    domain/authentication:
</code></pre></div></div>

<p>And the usage would still be the same:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;authentication/Authenticator.h&gt;
</code></pre></div></div>

<p>Nesting packages (packages inside other packages) is currently not supported.</p>

<h3 id="bits">Bits</h3>

<p>Bits are the way to share code with CPM. Bits are shared as source code and installed in the directory <code class="language-plaintext highlighter-rouge">bits</code>. Bits should not be included as part of the project repository.</p>

<p>There are two ways in which you can install a bit. First, you can simply install them from command line. Let’s say we want to install the <a href="https://cestframework.com/" rel="noopener" target="_blank">Cest</a> plugin. Cest is a testing framework installed as a header only plugin.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cpm install cest
</code></pre></div></div>

<p>After having run this command, the project structure is updated:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>main.cpp
project.yaml
authentication/Authenticator.cpp
authentication/Authenticator.h
bits/cest/plugin.yaml
bits/cest/cest/cest.h
</code></pre></div></div>

<p>This is a fast way of installing a dependency. However, the dependency is not recorded anywhere so if someone else downloads your project, the bit dependencies will not be known. In order to keep track of the project dependencies, the bits can be declared in the project descriptor:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name: awesome-project
packages:
    domain/authentication:
bits:
    cest: '1.0'
</code></pre></div></div>

<p>The bits declared in the project descriptor can be installed all at once using the following command from the project root:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cpm install
</code></pre></div></div>

<p>This command will detect which bits are not installed and will automatically download and install them.</p>

<h3 id="test-bits">Test Bits</h3>

<p>Projects can depend on bits only for testing purposes. In this case, those bits can be declared as <code class="language-plaintext highlighter-rouge">test_bits</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name: awesome-project
packages:
    domain/authentication:
test_bits:
    cest: '1.0'
</code></pre></div></div>

<p>This is particularly useful when developing bits. When installing a bit, the dependencies will be installed transitively. For example, if the project depends on bit A and bit A depends on bit B, then CPM will install transitively bit B when installing bit A. Imagine that now, bit A depends on <a href="https://cestframework.com/" rel="noopener" target="_blank">Cest</a> for testing. We don’t want that dependency to permeate through to our project so bit A should declare <code class="language-plaintext highlighter-rouge">Cest</code> as a <code class="language-plaintext highlighter-rouge">test_bit</code>.</p>

<h3 id="testing">Testing</h3>

<p>CPM is Test Driven Development ready.</p>

        </div>
        <div class="column is-one-fifth has-background-white-bis">
          <aside class="menu">
    <p class="menu-label">
        Archive
    </p>
    <ul class="menu-list">
        
        <li><a href="/2020/09/11/cpm-a-modern-tool-for-cpp.html" class="is-active">
            CPM: A Modern Tool for C/C++
        </a></li>
        
    </ul>
</aside>

        </div>
    </div>
  </section>
  
    <footer class="footer">
    <div class="columns is-mobile">
        <div class="column is-offset-2">
            <div class="content has-text-centered">
                <p><strong>cpm</strong> by Jordi Sánchez.</p>
            </div>
        </div>
        <div class="column">
            <a href="https://bulma.io">
                <img src="https://bulma.io/images/made-with-bulma.png" alt="Made with Bulma" width="128" height="24">
            </a>
        </div>
    </div>
</footer>
  </body>
</html>
